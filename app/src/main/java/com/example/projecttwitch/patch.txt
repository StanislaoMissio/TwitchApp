val url =
            "https://id.twitch.tv/oauth2/authorize?response_type=code&client_id=$KEY_CLIENT_ID&redirect_uri=https://localhost/&scope=viewing_activity_read+openid&state=c3ab8aa609ea11e793ae92361f002671"
        oauth.setOnClickListener {
            webview.webViewClient = object : WebViewClient() {
                override fun onPageStarted(view: WebView?, url: String?, favicon: Bitmap?) {
                    val code = "code="
                    if (url!!.contains(code)) {
                        // the GET request contains an authorization code
                        val accessCode = url.substringAfter(code).substringBefore("&")

                        editor = preferences.edit()
                        editor.putString("code", accessCode).apply()
                    }
                }
            }
            webview.loadUrl(url)
        }

        val callback = endpoint.getOAuth(KEY_CLIENT_ID, CLIENT_SECRET, preferences.getString("code", null))
        callback.enqueue(object : Callback<OAuth> {
            override fun onFailure(call: Call<OAuth>, t: Throwable) {
                Log.d("Retrofit Test", t.message.toString())
            }

            override fun onResponse(call: Call<OAuth>, response: Response<OAuth>) {
                editor = preferences.edit()
                editor.putString("access_token", response.body()?.accessToken)
                editor.putString("token_type", response.body()?.tokenType)
                editor.putString("refresh_token", response.body()?.refreshToken)
                editor.apply()
            }
        })